<template>
    <lightning-card title="Customer Engagement" icon-name="standard:insights">
        <div class="slds-p-around_small">
            <template if:true={isLoading}>
                <lightning-spinner alternative-text="Loading" size="small"></lightning-spinner>
            </template>

            <template if:false={isLoading}>
                <!-- Last Visit -->
                <div class="engagement-row">
                    <div class="slds-grid slds-grid_align-spread">
                        <span class="slds-text-body_small slds-text-color_weak">Last Visit</span>
                        <span class="slds-text-body_small">
                            <template if:true={engagement.lastVisit}>
                                {formattedLastVisit}
                            </template>
                            <template if:false={engagement.lastVisit}>
                                <span class="slds-text-color_weak">No data</span>
                            </template>
                        </span>
                    </div>
                </div>

                <!-- Engagement Level -->
                <div class="engagement-row">
                    <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
                        <span class="slds-text-body_small slds-text-color_weak">Engagement Level</span>
                        <span class={engagementLevelClass}>
                            {engagement.engagementLevel}
                        </span>
                    </div>
                </div>

                <!-- Cart Status -->
                <div class="engagement-row">
                    <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
                        <span class="slds-text-body_small slds-text-color_weak">Cart Status</span>
                        <template if:true={cartStatus.hasAbandonedCart}>
                            <span class="slds-badge slds-theme_warning">
                                Abandoned: {formattedCartValue}
                            </span>
                        </template>
                        <template if:false={cartStatus.hasAbandonedCart}>
                            <span class="slds-text-body_small">
                                <template if:true={cartStatus.cartValue}>
                                    Active: {formattedCartValue}
                                </template>
                                <template if:false={cartStatus.cartValue}>
                                    Empty
                                </template>
                            </span>
                        </template>
                    </div>
                </div>

                <!-- Email Engagement -->
                <div class="engagement-row">
                    <div class="slds-grid slds-grid_align-spread">
                        <span class="slds-text-body_small slds-text-color_weak">Email (30d)</span>
                        <span class="slds-text-body_small">
                            {emailEngagement.opens30Days} opens, {emailEngagement.clicks30Days} clicks
                        </span>
                    </div>
                </div>

                <!-- Browse History -->
                <template if:true={browseHistory.length}>
                    <div class="slds-m-top_small">
                        <p class="slds-text-title_caps slds-m-bottom_x-small">Recent Browse History</p>
                        <ul class="slds-list_dotted">
                            <template for:each={browseHistory} for:item="event">
                                <li key={event.timestamp} class="slds-text-body_small">
                                    {event.productName}
                                    <span class="slds-text-color_weak"> - {event.formattedTime}</span>
                                </li>
                            </template>
                        </ul>
                    </div>
                </template>

                <!-- Data Cloud Attribution -->
                <div class="slds-m-top_small slds-text-align_center">
                    <span class="slds-text-body_small slds-text-color_weak">
                        <lightning-icon icon-name="utility:data_cloud" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                        Powered by Data Cloud
                    </span>
                </div>
            </template>
        </div>
    </lightning-card>
</template>
